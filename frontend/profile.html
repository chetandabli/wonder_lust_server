<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profile ‚Äî Wonderlust Travels</title>
  <style>
    :root {
      --brand: #0f9cf5;
      --brand-soft: #e0f2ff;
      --bg: #f3f4f6;
      --card: #ffffff;
      --ink: #0f172a;
      --muted: #6b7280;
      --border: #e5e7eb;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top left, #dbeafe 0, #f9fafb 42%, #eef2ff 100%);
      color: var(--ink);
      min-height: 100vh;
    }

    /* ---------- Navbar ---------- */
    .top-nav {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 50;
      background: linear-gradient(90deg, rgba(15, 23, 42, .92), rgba(30, 64, 175, .92));
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(15, 23, 42, .45);
    }

    .top-nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .top-nav button {
      border-radius: 999px;
    }

    /* PAGE CONTAINER --------------- */
    .container {
      max-width: 960px;
      margin: 100px auto 40px;
      padding: 0 16px;
      min-height: calc(100vh - 300px);
    }

    /* TOP BAR -------------------- */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
      gap: 10px;
    }

    .brand-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: linear-gradient(135deg, #0284c7, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 18px;
      font-weight: 700;
      box-shadow: 0 10px 25px rgba(15, 118, 110, 0.35);
    }

    h1 {
      font-size: 1.6rem;
      font-weight: 700;
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
    }

    .btn {
      background: var(--brand);
      color: #fff;
      border: 0;
      padding: 8px 14px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.2);
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.24);
      background: #0284c7;
    }

    .btn.secondary {
      background: transparent;
      color: var(--ink);
      border: 1px solid #e5e7eb;
      box-shadow: none;
    }

    .btn.secondary:hover {
      background: #f3f4f6;
      transform: none;
      box-shadow: none;
    }

    .btn.danger {
      background: #ef4444;
      box-shadow: 0 8px 18px rgba(239, 68, 68, 0.25);
    }

    .btn.danger:hover {
      background: #dc2626;
    }

    /* MAIN LAYOUT WITH SIDEBAR --------------------------------- */
    .layout {
      display: flex;
      gap: 18px;
      align-items: flex-start;
    }

    .sidebar {
      width: 210px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 16px;
      padding: 14px 12px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.05);
      backdrop-filter: blur(10px);
    }

    .sidebar-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .nav-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .nav-item {
      width: 100%;
      text-align: left;
      border-radius: 999px;
      padding: 8px 12px;
      border: 0;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      color: var(--muted);
      transition: background 0.12s ease, transform 0.08s ease, box-shadow 0.08s ease, color 0.12s ease;
    }

    .nav-item span.icon {
      font-size: 1.05rem;
    }

    .nav-item.active {
      background: var(--brand-soft);
      color: #0369a1;
      font-weight: 600;
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.12);
      transform: translateY(-1px);
    }

    .nav-item:hover:not(.active) {
      background: #f3f4f6;
    }

    .main-column {
      flex: 1;
      min-width: 0;
    }

    @media (max-width: 799px) {
      .layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
      }

      .nav-list {
        flex-direction: row;
        overflow-x: auto;
      }

      .nav-item {
        flex: 1 0 auto;
        justify-content: center;
      }
    }

    /* CARDS ----------------------------------------------------- */
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 20px 18px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
      margin-bottom: 18px;
      border: 1px solid rgba(148, 163, 184, 0.18);
    }

    h2 {
      font-size: 1.25rem;
      margin-bottom: 6px;
    }

    h3 {
      font-size: 1.1rem;
      margin-bottom: 4px;
    }

    .muted {
      color: var(--muted);
      font-size: .93rem;
    }

    .user-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .avatar {
      width: 46px;
      height: 46px;
      border-radius: 999px;
      background: var(--brand-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #0284c7;
      font-size: 1.1rem;
    }

    .user-contact {
      margin-top: 8px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f3f4f6;
      font-size: 0.8rem;
      color: var(--muted);
      margin-right: 8px;
      margin-top: 4px;
    }

    .pill span {
      font-weight: 500;
      color: var(--ink);
    }

    /* LAYOUT FOR SECTIONS -------------------------------------- */
    .sections-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
    }

    @media (min-width: 800px) {
      .sections-grid {
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      }
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .section-header h3 {
      margin: 0;
    }

    .section-line {
      height: 1px;
      background: linear-gradient(to right, rgba(148, 163, 184, 0.35), transparent);
      margin: 8px 0 12px;
    }

    /* LISTS ----------------------------------------------------- */
    .fb-item,
    .bk-item {
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #f9fafb;
      transition: transform 0.08s ease, box-shadow 0.12s ease, border-color 0.12s ease;
    }

    .fb-item:hover,
    .bk-item:hover {
      transform: translateY(-1px);
      border-color: #d1d5db;
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.06);
    }

    .meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: .86rem;
      color: var(--muted);
      gap: 8px;
      margin-bottom: 4px;
    }

    .meta-title {
      font-weight: 600;
      color: var(--ink);
      font-size: 0.9rem;
    }

    .meta-sub {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .tag {
      padding: 3px 10px;
      border-radius: 999px;
      font-size: .78rem;
      background: #e5e7eb;
      color: #374151;
      text-transform: capitalize;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 6px;
    }

    .tag-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: currentColor;
    }

    .tag.pending {
      background: #fef3c7;
      color: #92400e;
    }

    .tag.confirmed {
      background: #dcfce7;
      color: #166534;
    }

    .tag.cancelled {
      background: #fee2e2;
      color: #b91c1c;
    }

    .empty {
      padding: 10px 12px;
      border-radius: 10px;
      background: #f1f5f9;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .empty span {
      font-size: 1.1rem;
      margin-right: 6px;
    }

    .rating-stars {
      font-size: 0.9rem;
      color: #f97316;
      font-weight: 600;
    }

    .nowrap {
      white-space: nowrap;
    }

    /* ---------- Footer ---------- */
    footer {
      background: #0b1220;
      color: #cbd5e1;
      margin-top: 40px;
    }

    .footer-wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 28px 16px;
      display: grid;
      gap: 18px;
      grid-template-columns: 1.2fr 1fr 1fr;
    }

    footer h4 {
      color: #fff;
      margin-bottom: 10px;
    }

    footer a {
      color: #cbd5e1;
      text-decoration: none;
    }

    footer a:hover {
      color: #fff;
    }

    .foot-bottom {
      border-top: 1px solid rgba(255, 255, 255, .08);
      padding: 12px 16px;
      text-align: center;
      opacity: .8;
    }

    @media (max-width: 820px) {
      .footer-wrap {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>

  <!-- ===== Navbar ===== -->
  <nav class="top-nav">
    <div class="top-nav-inner">
      <div style="
        display:flex;
        align-items:center;
        gap:10px;
        font-size:1.4rem;
        font-weight:bold;
        color:#a3e635;
        cursor: pointer;
      " onclick="location.href='index.html'">
        <img src="logo.png" alt="Wonderlust Travels Logo" style="
          height:40px;
          width:auto;
          object-fit:contain;
          vertical-align:middle;
        ">
        WONDERLUST TRAVELS
      </div>

      <div style="display:flex; gap:15px; align-items:center;">
        <span style="font-size:1rem; font-weight:500; color:white;">üìû +91 9876543210</span>

        <button id="authBtn" style="
          background:#0072ff;
          color:white;
          border:none;
          padding:8px 16px;
          border-radius:999px;
          cursor:pointer;
          transition:0.3s;
          font-weight:600;
        " onmouseover="this.style.background='#0056c2'"
          onmouseout="this.style.background='#0072ff'"></button>

        <button onclick="location.href='feedback.html'" style="
          background:#0072ff;
          color:white;
          border:none;
          padding:8px 16px;
          border-radius:999px;
          cursor:pointer;
          transition:0.3s;
          font-weight:600;
        " onmouseover="this.style.background='#0056c2'"
          onmouseout="this.style.background='#0072ff'">
          Feedback
        </button>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="top-bar">
      <div>
        <div class="brand-title">
          <div class="brand-logo">W</div>
          <div>
            <h1>Your profile</h1>
            <p class="subtitle">View your journeys, feedback, and account details in one place.</p>
          </div>
        </div>
      </div>
      <div class="btn-group">
        <button class="btn" onclick="location.href='booking.html'">
          ‚úàÔ∏è <span>Booking</span>
        </button>
        <button class="btn" onclick="location.href='feedback.html'">
          üìù <span>Feedback</span>
        </button>
        <button class="btn secondary" onclick="location.href='index.html'">
          ‚¨ÖÔ∏è <span>Back to site</span>
        </button>
        <button class="btn danger" onclick="handleLogout()">
          üö™ <span>Logout</span>
        </button>
      </div>
    </div>

    <!-- LAYOUT: SIDEBAR + MAIN --------------------------------- -->
    <div class="layout">
      <!-- SIDE NAV -->
      <aside class="sidebar">
        <div class="sidebar-title">Profile menu</div>
        <nav class="nav-list">
          <button class="nav-item active" data-section="profile" onclick="setActiveSection('profile')">
            <span class="icon">üë§</span>
            <span>Profile overview</span>
          </button>
          <button class="nav-item" data-section="bookings" onclick="setActiveSection('bookings')">
            <span class="icon">üß≥</span>
            <span>Your bookings</span>
          </button>
          <button class="nav-item" data-section="feedback" onclick="setActiveSection('feedback')">
            <span class="icon">üí¨</span>
            <span>Your feedback</span>
          </button>
        </nav>
      </aside>

      <!-- MAIN COLUMN -->
      <div class="main-column">
        <!-- USER CARD -->
        <div class="card" id="userCard">
          <div class="user-row">
            <div class="avatar" id="userAvatar">U</div>
            <div>
              <h2 id="userName">Loading...</h2>
              <p class="muted" id="userTagline">Globetrotter in the making ‚ú®</p>
            </div>
          </div>

          <div class="user-contact" id="userContact">
            <div id="userEmail" class="pill" style="display:none;">
              üìß <span></span>
            </div>
            <div id="userPhone" class="pill" style="display:none;">
              üì± <span></span>
            </div>
          </div>
        </div>

        <!-- BOOKINGS -->
        <div class="card" id="bookingsCard">
          <div class="section-header">
            <div>
              <h3>Your bookings</h3>
              <p class="muted">These are booking requests you‚Äôve submitted.</p>
            </div>
            <span class="muted nowrap" style="font-size:0.8rem;">Status updated by our team</span>
          </div>
          <div class="section-line"></div>
          <div id="bookingList" class="booking-list"></div>
          <div id="noBookings" class="empty" style="display:none;">
            <span>üß≥</span>No trips yet. Plan your next escape from the booking page.
          </div>
        </div>

        <!-- FEEDBACK -->
        <div class="card" id="feedbackCard">
          <div class="section-header">
            <div>
              <h3>Your feedback</h3>
              <p class="muted">Thoughts you‚Äôve shared with us.</p>
            </div>
          </div>
          <div class="section-line"></div>
          <div id="feedbackList" class="feedback-list"></div>
          <div id="noFeedback" class="empty" style="display:none;">
            <span>üí¨</span>No feedback yet. We‚Äôd love to hear from you on the feedback page.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Footer ===== -->
  <footer>
    <div class="footer-wrap">
      <div>
        <h4>About Wonderlust Travels</h4>
        <p>We curate unforgettable group trips and crafted holidays across India & abroad. 1000+ happy travelers.</p>
      </div>
      <div>
        <h4>Contact</h4>
        <p>üìû +91 9876543210<br />‚úâÔ∏è hello@wanderlusttravels.com</p>
      </div>
      <div>
        <h4>Quick Links</h4>
        <p><a href="feedback.html">Feedback</a> ¬∑ <a href="feedback.html">About</a> ¬∑ <a href="#">Terms</a></p>
      </div>
    </div>
    <div class="foot-bottom">¬© <span id="year"></span> Wonderlust Travels ‚Äî All rights reserved.</div>
  </footer>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    const API_BASE = 'http://localhost:5000';
    const USER_STORAGE_KEY = 'wander_user';

    const authBtn = document.getElementById('authBtn');

    let currentUser = null;
    let authToken = null;

    // Init auth + navbar + basic guard for this page
    (function initAuth() {
      const stored = localStorage.getItem(USER_STORAGE_KEY);
      if (!stored) {
        alert('You must log in first.');
        window.location.href = 'login.html';
        return;
      }

      try {
        const u = JSON.parse(stored);
        if (!u || !u.id || !u.token) {
          localStorage.removeItem(USER_STORAGE_KEY);
          alert('Your session has expired. Please log in again.');
          window.location.href = 'login.html';
          return;
        }
        currentUser = u;
        authToken = u.token;
      } catch (err) {
        console.error('Failed to parse stored user:', err);
        localStorage.removeItem(USER_STORAGE_KEY);
        alert('Please log in again.');
        window.location.href = 'login.html';
        return;
      }

      // Navbar button label & action
      if (currentUser.role === 'admin') {
        authBtn.textContent = 'Admin Panel';
        authBtn.onclick = () => window.location.href = 'admin.html';
      } else {
        authBtn.textContent = 'Profile';
        authBtn.onclick = () => window.location.href = 'profile.html';
      }
    })();

    function handleLogout() {
      localStorage.removeItem(USER_STORAGE_KEY);
      sessionStorage.removeItem(USER_STORAGE_KEY);
      window.location.href = 'login.html';
    }

    // SIDENAV TAB LOGIC -----------------------------------------
    function setActiveSection(section) {
      const bookingsCard = document.getElementById('bookingsCard');
      const feedbackCard = document.getElementById('feedbackCard');
      const userCard = document.getElementById('userCard');

      if (section === 'profile') {
        userCard.style.display = '';
        bookingsCard.style.display = 'none';
        feedbackCard.style.display = 'none';
      } else if (section === 'bookings') {
        userCard.style.display = 'none';
        bookingsCard.style.display = '';
        feedbackCard.style.display = 'none';
      } else if (section === 'feedback') {
        userCard.style.display = 'none';
        bookingsCard.style.display = 'none';
        feedbackCard.style.display = '';
      }

      document.querySelectorAll('.nav-item').forEach(btn => {
        if (btn.getAttribute('data-section') === section) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    // PROFILE DATA LOADING --------------------------------------
    async function loadProfile() {
      // Safety check
      if (!currentUser || !authToken) {
        return;
      }

      const user = currentUser;

      const name = user.name || 'Traveler';
      document.getElementById('userName').textContent = name;
      document.getElementById('userAvatar').textContent = (name[0] || 'U').toUpperCase();

      const emailPill = document.getElementById('userEmail');
      const emailSpan = emailPill.querySelector('span');
      const phonePill = document.getElementById('userPhone');
      const phoneSpan = phonePill.querySelector('span');

      if (user.email) {
        emailSpan.textContent = user.email;
        emailPill.style.display = 'inline-flex';
      }
      if (user.phone) {
        phoneSpan.textContent = user.phone;
        phonePill.style.display = 'inline-flex';
      }

      try {
        const res = await fetch(`${API_BASE}/api/profile/${user.id}`, {
          headers: {
            'Authorization': `Bearer ${authToken}`
          }
        });

        if (res.status === 401 || res.status === 403) {
          localStorage.removeItem(USER_STORAGE_KEY);
          alert('Your session has expired or is invalid. Please log in again.');
          window.location.href = 'login.html';
          return;
        }

        if (!res.ok) {
          console.error('Profile fetch error', res.status);
          return;
        }

        const data = await res.json();
        renderBookings(data.bookings || []);
        renderFeedback(data.feedback || []);
      } catch (err) {
        console.error(err);
      }
    }

    function renderBookings(items) {
      const list = document.getElementById('bookingList');
      const empty = document.getElementById('noBookings');
      list.innerHTML = '';

      if (!items.length) {
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      items.forEach(bk => {
        const div = document.createElement('div');
        div.className = 'bk-item';

        const meta = document.createElement('div');
        meta.className = 'meta-row';

        const left = document.createElement('div');
        left.innerHTML = `<div class="meta-title">${bk.destination}</div>
                          <div class="meta-sub">${
                            bk.start_date || bk.end_date
                              ? `Dates: ${bk.start_date || '‚Äî'} ‚Üí ${bk.end_date || '‚Äî'}`
                              : 'Dates: ‚Äî'
                          }</div>`;

        const right = document.createElement('div');
        right.style.textAlign = 'right';
        const dt = new Date(bk.created_at);
        right.innerHTML = `<div class="meta-sub">${dt.toLocaleDateString()}</div>
                           <div class="meta-sub">${dt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>`;

        meta.appendChild(left);
        meta.appendChild(right);

        const travelers = document.createElement('p');
        travelers.className = 'muted';
        travelers.style.marginTop = '4px';
        travelers.textContent = `Travelers: ${bk.travelers || '‚Äî'}`;

        const status = document.createElement('span');
        const statusClass = (bk.status || 'pending').toLowerCase();
        status.className = 'tag ' + statusClass;
        status.innerHTML = `<span class="tag-dot"></span>${bk.status || 'pending'}`;

        div.appendChild(meta);
        div.appendChild(travelers);
        div.appendChild(status);

        list.appendChild(div);
      });
    }

    function renderFeedback(items) {
      const list = document.getElementById('feedbackList');
      const empty = document.getElementById('noFeedback');
      list.innerHTML = '';

      if (!items.length) {
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      items.forEach(fb => {
        const div = document.createElement('div');
        div.className = 'fb-item';

        const meta = document.createElement('div');
        meta.className = 'meta-row';

        const left = document.createElement('div');
        const ratingText = fb.rating ? `<span class="rating-stars">‚Ä¢ ${fb.rating}‚òÖ</span>` : '';
        left.innerHTML = `<div class="meta-title">${fb.type || 'General'} ${ratingText}</div>`;

        const right = document.createElement('div');
        right.style.textAlign = 'right';
        const dt = new Date(fb.created_at);
        right.innerHTML = `<div class="meta-sub">${dt.toLocaleDateString()}</div>
                           <div class="meta-sub">${dt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>`;

        meta.appendChild(left);
        meta.appendChild(right);

        const msg = document.createElement('p');
        msg.style.marginTop = '4px';
        msg.textContent = fb.message || '(No message)';

        const status = document.createElement('span');
        status.className = 'tag';
        status.innerHTML = `<span class="tag-dot"></span>${fb.status || 'new'}`;

        div.appendChild(meta);
        div.appendChild(msg);
        div.appendChild(status);

        list.appendChild(div);
      });
    }

    // Initial load
    loadProfile();
    setActiveSection('profile');
  </script>
</body>

</html>
